<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport"
      content="width=device-width,
       initial-scale=1.0">
    <title>MoonSpeedGS</title>
    <link rel="icon" href="img/favicon.ico" type="image/ico">
    <link rel="stylesheet" href="css/estilos.css">
    <link rel="stylesheet" href="css/bootstrap.css">
   
  </head>
  <body>
    <div id="mensaje" class="dialog-overlay" style=" display:run-in;">
        <div class="dialog-card" style=";padding:0px;border:3px gold solid;background: transparent">
            <div class="col-lg-12 col-md-12 col-sm-12" style="background:transparent;padding-top:5px;border-radius:14px 14px 0px 0px;border-bottom:3px solid gold;text-align: center">
            <strong><h1 style="margin:10px 10px 10px 10px;padding-bottom:10px;color:gold;font-size:30px;text-align: center ">GAME OVER</h1></strong>
            </div>
            <div class="dialog-info" style="padding: 25px 30px;">
                <center><h5 style="color:white;" id="mensajeMuerte"></h5>
                
                <div class="row justify-content-center" style="text-align:center">
                    <div class="col-lg-12 col-md-12 col-sm-12" style="text-align: center;margin-bottom: 0px">
                        <h5 style="color:gold;" style="margin-bottom: 0px">Puntuación</h5>
                    </div>
                    <div class="col-lg-12 col-md-12 col-sm-12" style="text-align: center">
                        <h1 style="color:white;" id="mensajePuntuacion"></h1>
                    </div><br>
                    <div class="col-lg-12 col-md-12 col-sm-12" style="text-align: center">
                        <h5 style="color:white;">Para volver a jugar selecciona la nave que deseas</h5>
                    </div>
                    <div class="col-lg-6 col-md-12 col-sm-12" style="text-align: center">
                        <input type="image" onclick="asignarID('img/naveP.png');" src="img/naveP.png" height="130px !important" width="180px !important" style="border: 2px solid gold; border-radius: 15px; padding: 8px;margin-top: 15px"/>
                    </div><br>
                    <div class="col-lg-6 col-md-12 col-sm-12" style="text-align: center">
                        <input type="image" onclick="asignarID('img/naveP2.png');" src="img/naveP2.png" height="130px !important" width="180px !important" style="border: 2px solid gold; border-radius: 15px; padding: 8px;margin-top: 15px"/>
                    </div>

                </div>
                </center>
            </div>
        </div>
    </div>
  	<section class="features_area" id="features_counter"  style="display: block">
		<div class="container" style="margin:50px auto">
          <div class="row counter_wrapper" style="background:transparent;border-radius:15px;border: 3px solid gold">
            <div class="col-md-12 col-md-offset-3" >
                <div class="panel panel-login">
                    <div class="panel-heading" style="padding:20px">
                        <div class="panel-body">
                            <div class="row justify-content-center">
                                <div class="col-lg-12">
                                    
                                        <div class="row justify-content-center" style="text-align:center">
                                            <div class="col-lg-4 col-md-3 col-sm-3" style="text-align: right">
                                                <img src="img/nave2.png" />
                                            </div>
                                            <div class="col-lg-4 col-md-5 col-sm-5">
                                                <h1 style="color:gold;text-align: center;font-family: Showcard Gothic,sans-serif">Moon Speed</h1><br>
                                            </div>
                                            <div class="col-lg-4 col-md-3 col-sm-3" style="text-align: left">
                                                <img src="img/nave2.png" />
                                            </div>
                                        </div>
                                        
                                        <p style="text-align: center; margin-bottom:0px;color: white;font-size: 20px">
                                            Bienvenidos a MoonSpeed
                                        </p><br>
                                        <p style="text-align: center; margin-bottom:0px;color: white;font-size: 20px">
                                            Instrucciones:
                                        </p><br>
                                        <p style="text-align: center; margin-bottom:0px;color: white;font-size: 20px">
                                            Las flechas son para moverse y para ganar puntos las naves enemigas deben de llegar al límite inferior y si chocas con alguna pierdes el juego
                                        </p><br><br>
                                        <p style="text-align: center; margin-bottom:0px;color: white;font-size: 20px">
                                            Ingrese su nombre de usuario
                                        </p><br>
                                        <div style="text-align: center">
                                            <input type="text" id="name" name="name" required="true" value="" tabindex="1" minlength="1" maxlength="10" 
                                               style="border: 2px solid gold; border-radius: 15px; padding: 8px;margin-top: 15px;background: transparent;color: gold;text-align: center"/><br>
                                        </div><br><br>
                                        <p style="text-align: center; margin-bottom:0px;color: gold;font-size: 20px">
                                            Selecciona la nave preferida para empezar a jugar
                                        </p><br>
                                        <div class="row justify-content-center" style="text-align:center">
                                            <div class="col-lg-3 col-md-6 col-sm-6" style="text-align: center">
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6" style="text-align: center">
                                                <input type="image" onclick="asignarID('img/naveP.png');" src="img/naveP.png" height="130px !important" width="180px !important" style="border: 2px solid gold; border-radius: 15px; padding: 8px;margin-top: 15px"/>
                                            </div><br>
                                            <div class="col-lg-3 col-md-6 col-sm-6" style="text-align: center">
                                                <input type="image" onclick="asignarID('img/naveP2.png');" src="img/naveP2.png" height="130px !important" width="180px !important" style="border: 2px solid gold; border-radius: 15px; padding: 8px;margin-top: 15px"/>
                                            </div>
                                            
                                            <div class="col-lg-3 col-md-6 col-sm-6" style="text-align: center">
                                            </div>
                                            <input type="hidden" id="avanza" value="false"/>
                                        </div>
                                        
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
            </div>
        </div>
      </section>
      <section id="videogame"  style="display: none; ">
        <script>
            function aleatorio(menor, mayor) {
                return menor + Math.floor(Math.random() * (mayor - menor + 1));
            }
            function chocaNave(e1, e2) {
                const rE1 =
                  e1.getBoundingClientRect();
                const rE2 =
                  e2.getBoundingClientRect();
                
                return (rE1.right >= rE2.left &&
                  rE1.left <= rE2.right &&
                  rE1.top <= rE2.bottom &&
                  rE1.bottom >= rE2.top);
                
              }
            function gameOver(){
                  var instrucciones = document.getElementById('features_counter');
                  //instrucciones.style.display = "block";
                  var videogame = document.getElementById('videogame');
                  //videogame.style.filter = "blur(4px)";
                  //user.value="";
                  var mensajeGameOver = document.getElementById('mensaje');
                  mensajeGameOver.style.display = "block";
                  
                  document.getElementById('mensajeMuerte').innerHTML = "Oh no "+user.value+" tu nave a chocado";
                  document.getElementById('mensajePuntuacion').innerHTML = puntaje.value;
                  
                  avanza.value='false';
                  ne=new ControladorNaveP();
                  ne.detenerIntervalo();
                  
            }

            /** @interface */
            class SeMueve {
              muévete() {
                throw new Error("intf");
              }
              resetearNave(value){
                throw new Error("intf");
              }
            }

            /** @implements {SeMueve} */
            class NavePrincipal extends HTMLElement {
                  
              connectedCallback() {
                
                this.innerHTML = "<img id='imgP' src='' height='100px !important' width='150px !important'/>";
                this.style.position =
                  "fixed";
                this.style.fontSize =
                  "2rem";
                this.id="con";
                this.resetearNave(this);
              }
                
              resetearNave(value){
                  value.x = Math.floor(window.innerWidth/2.3);
                  value.y = window.innerHeight /4.2;
                  value.style.right =`${value.x}px`;
                  value.style.bottom =`${value.y}px`;
                  
              }
              muévete() {
                this.x = (this.x + 30) %
                  window.innerWidth;
                this.style.right =
                  `${this.x}px`;
              }
              
              asciendeNave(){
                 // window.alert(window.outerHeight);


                if(this.y < window.innerHeight /1.3){
                    this.y = (this.y + 50) %
                    window.innerHeight;
                    this.style.bottom =
                    `${this.y}px`;
                   if(imgP.src.includes('P2')){
                       imgP.src="img/naveP2.png";
                   }else{
                       imgP.src="img/naveP.png";
                   }
                }
              }
              desciendeNave(){
                 /* window.alert(window.innerHeight/4);
                  window.alert(this.y);*/
                if(this.y>window.innerHeight /4.2){
                     this.y = (this.y - 50) %
                    window.innerHeight;
                    this.style.bottom =
                    `${this.y}px`;
                   if(imgP.src.includes('P2')){
                       imgP.src="img/naveP2.png";
                   }else{
                       imgP.src="img/naveP.png";
                   }
                }

              }
               avanzaNave(){
                 /* window.alert(window.innerHeight/4);*/
                  //window.alert(this.x);
                   if (this.x > 1*window.innerWidth/9) {
                        this.x = (this.x - 50) % window.innerWidth;
                        this.style.right= 
                        `${this.x}px`;
                       
                       if(imgP.src.includes('P2')){
                           imgP.src="img/naveP2De.png";
                       }else{
                           imgP.src="img/navePDe.png";
                       }
                    }

               }
                retrocedeNave(){
                 /* window.alert(window.innerHeight/4);*/
                    if (this.x <  4.2 * window.innerWidth / 5) {
                        this.x = (this.x + 50) % window.innerWidth;
                        this.style.right= 
                        `${this.x}px`;    
                        if(imgP.src.includes('P2')){
                           imgP.src="img/naveP2Iz.png";
                        }else{
                           imgP.src="img/navePIz.png";
                        }
                    }

                }
                actualizaNave(valor){
                    //var im = document.getElementById('imgP');
                    imgP.style =
                        `left: ${xN}px; bottom: ${yMenor}px;top:${yN}px; right: ${xMenor}px;`;
                }

              }

            customElements.define(
              "nave-princi", NavePrincipal);

            /** @implements {SeMueve} */
            class NaveEnemigaYellow
              extends HTMLElement {
              connectedCallback() {
                this.innerHTML = "<img src='img/enemy.png' id='movNav' height='100px !important' width='150px !important' style='transform: rotate(180deg);'/>";
                this.style.position =
                  "fixed";
                this.style.fontSize =
                  "2rem";
                this.resetearNave(this);
              }
              resetearNave(value){
                  value.x = aleatorio(0,1*window.innerWidth/9);
                  value.y = 50;
                  value.style.left =`${value.x}px`;
                  value.style.top =`${value.y}px`;
                  
              }
            
              muévete() {
                if (chocaNave(this, imgP) && avanza.value=='true' ) {
                  if(!imgP.src.includes('media')){
                    imgP.src = "https://media.giphy.com/media/d4aVHC1HKnButuXC/giphy.gif";
                  }
                  gameOver();
                }else{
                    if(this.y<window.innerHeight/1.3){
                  
                      /*this.x = window.innerWidth / 3 +
                       window.innerWidth / 5 * Math.sin(0.2 * this.y);*/
                      this.x =
                          (this.x + 6) % window.innerWidth;
                      this.y =
                          (this.y + 6) % window.innerHeight;
                        
                   }else{
                      if(avanza.value=='true'){
                         puntaje.value=parseInt(puntaje.value,10)+1;  
                      }
                      
                      this.x =aleatorio(0,
                      Math.floor(
                        window.innerWidth));
                      this.y =50;
                   }
                      this.style.left =
                          `${this.x}px`;
                      this.style.top =
                          `${this.y}px`;
                   //this.y = (this.y + 1) % window.innerWidth;
                }
                  
               
              }
            }
            customElements.define(
              "nave-yellow", NaveEnemigaYellow);

            /** @implements {SeMueve} */
            class NaveEnemigaRed
              extends HTMLElement {
              connectedCallback() {
                
                this.innerHTML = "<img src='img/enemy2.png' id='movNav' height='100px !important' width='150px !important'/>";
                this.style.position =
                  "fixed";
                this.style.fontSize =
                  "2rem";
                this.resetearNave(this);
              }
              
              resetearNave(value){
                  value.x = aleatorio(0,1*window.innerWidth/9);
                  value.y = 50;
                  value.style.left =`${value.x}px`;
                  value.style.top =`${value.y}px`;
                  
              }
                  
              muévete() {
                if (chocaNave(this, imgP) && avanza.value=='true') {
                  if(!imgP.src.includes('media')){
                    imgP.src = "https://media.giphy.com/media/d4aVHC1HKnButuXC/giphy.gif";
                  }
                  gameOver();
                }else{
                    if(this.y<window.innerHeight/1.4){
                      this.y = (this.y + 6) %
                      window.innerHeight;
                       this.style.top =
                      `${this.y}px`;
                   }else{
                      if(avanza.value=='true'){
                         puntaje.value=parseInt(puntaje.value,10)+1;  
                      }
                      this.x =aleatorio(0,
                      Math.floor(
                        window.innerWidth));
                      this.y =50;
                       this.style.left =
                          `${this.x}px`;
                      this.style.top =
                          `${this.y}px`;
                   }
                }
               
                  
              

              }
            }
            customElements.define(
              "nave-red", NaveEnemigaRed);

           /*---------------------Controlador para la nave principal---------------------*/ 

          class ControladorNaveP extends HTMLElement {
            connectedCallback() {
                
                this.retrocedeNave = this.
                retrocedeNave.bind(this);
                this.avanzaNave = this.
                avanzaNave.bind(this);
                this.asciendeNave = this.
                asciendeNave.bind(this);
                this.desciendeNave = this.
                desciendeNave.bind(this);

              this.innerHTML =
                /* html */
                `
                  <button onclick="this.
                    parentElement.asciendeNave();"  style="margin:10px; background:transparent;border:2px gold solid;color:gold; border-radius:10px">
                    ▲
                  </button><br>
                  <button onclick="this.
                    parentElement.retrocedeNave();" style="background:transparent;border:2px gold solid;color:gold; border-radius:10px">
                    ◀
                  </button>
                  <button onclick="this.
                    parentElement.desciendeNave();"  style=" background:transparent;border:2px gold solid;color:gold; border-radius:10px">
                    ▼
                  </button>
                  <button onclick="this.
                    parentElement.avanzaNave();"  style="background:transparent;border:2px gold solid;color:gold; border-radius:10px">
                    ▶
                  </button>
                    
                `;
              this.naveP =
                new NavePrincipal();
              this.enemigas =
                [new NaveEnemigaRed(),
                new NaveEnemigaYellow(),
                new NaveEnemigaRed(),
                new NaveEnemigaYellow(),
                ];
              this.append(this.naveP);
                
              for (let nav of this.enemigas) {
                    const jss =setInterval(function(){
                        nav.muévete();
                    },45);
                this.append(nav);
              }

            }
                
              detenerIntervalo(){
                  clearInterval(this.jss);
              } 
              retrocedeNave() {
                this.naveP.retrocedeNave();
              }
              avanzaNave() {
                this.naveP.avanzaNave();
              }
               asciendeNave() {
               this.naveP.asciendeNave();
              }
               desciendeNave() {
                this.naveP.desciendeNave();
              }
              
              

          }
          customElements.define(
            "controlador-web",
            ControladorNaveP);
          </script>

        
        <div class="container" >
            <div class="row justify-content-center" style="color: gold">
                <div class="col-lg-6 col-md-6 col-sm-6" style="text-align: center">
                    <h3>Usuario: <input type="text" disabled  id="user" style="background:transparent;border:0px solid black;color:gold;width:190px; " value=""/></h3>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6" style="text-align: center;">
                    <h3>Puntaje: <input type="text" id="puntaje" disabled style="background:transparent;border:0px solid black;color:gold;width:60px; " value="0"/> </h3>
                </div><br>
            </div>
        </div>
        
        
          <div id="pie" style="text-align:center">
            <controlador-web>
            </controlador-web><br><br>
              <footer >
                &copy; 2021
                Angel Isaac Garrido Sánchez.
              </footer>
          </div>
        
      </section>
      <script>
        /*Este script me sirve para la funcionalidad de la página*/
        pie.style=`margin-top:${2.7* window.innerHeight / 3.7}px;text-align: center; font-size:23px;color:white`;
          
        document.addEventListener('keydown', mover);
        function mover(e){
            naveP = new NavePrincipal();
            if(e.keyCode == '39'){//derecha
               naveP.avanzaNave();
            }
            if(e.keyCode == '37'){//Izquierda
               naveP.retrocedeNave();
            }
            if(e.keyCode == '38'){//arriba
               naveP.asciendeNave();
            }
            if(e.keyCode == '40'){//abajo
               naveP.desciendeNave();
                
            }
         }
        function asignarID(idV){
           // $("#nave").val(idV);
            
            var name = document.getElementById('name');
            //window.alert(name.value);
            if(name.value != ''){
                avanza.value='true';
                puntaje.value="0";
                var mensajeGameOver = document.getElementById('mensaje');
                mensajeGameOver.style.display = "none";
                var im = document.getElementById('imgP');
                im.src = idV;
                var user = document.getElementById('user');
                user.value = name.value;
                var instrucciones = document.getElementById('features_counter');
                instrucciones.style.display = "none";
                var videogame = document.getElementById('videogame');
                videogame.style.display = "block";
                //videogame.style.filter = "blur(0px)";
                var nP=new NavePrincipal();
                nP.resetearNave(document.querySelector("nave-princi"));
                var nR=new NaveEnemigaRed();
                nR.resetearNave(document.querySelector("nave-red"));
                var nY=new NaveEnemigaYellow();
                nY.resetearNave(document.querySelector("nave-yellow"));
            }else{
                window.alert('Error, por favor ingrese un nombre');
            }
            
        }
      </script>  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
